<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>微信浏览器h5页面音乐自动播放（2020.02可用） - PRELUDE</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='../style/basic_styles.css'>
    <link rel="stylesheet" href="https://unpkg.com/simpledotcss/simple.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src=https://www.googletagmanager.com/gtag/js?id=UA-92314993-3></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-92314993-3');
    </script>
    <script>
        const page_object = {"contents": [{"children": null, "contents": [{"id": "16899d30-8f2f-4880-9909-0458dd2f069b", "level": 1, "text": "1. \u4f20\u7edf\u65b9\u6cd5\u7684\u4e0d\u53ef\u884c\u6027"}, {"id": "0ffe13ea-af8e-4409-af6e-3c5a34adcc04", "level": 1, "text": "2. \u65b9\u6cd5"}, {"id": "efd96638-273b-4bc1-851a-e0077ea83efb", "level": 1, "text": "3. \u97f3\u4e50\u52a0\u8f7d\u72b6\u6001"}], "type": "table_of_contents"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u5728\u505a\u4e00\u4e9b\u57fa\u4e8e\u5fae\u4fe1\u6d4f\u89c8\u5668\u7684h5\u9875\u9762\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u4f1a\u5e0c\u671b\u8fdb\u5165\u5373\u64ad\u653e\u97f3\u4e50\uff0c\u5728\u641c\u96c6\u8d44\u6599\u540e\u627e\u5230\u4e86\u4e00\u79cd\u5b9e\u9645\u53ef\u7528\u7684\u65b9\u6cd5\u3002\n\u9700\u8981\u770bDemo\u7684\u53ef\u4ee5\u76f4\u63a5\u770b\u6700\u540e\u4e00\u4e2a\u6807\u9898\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "id": "16899d30-8f2f-4880-9909-0458dd2f069b", "text": [{"annotations": "", "color": "default", "content": "1", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": ". \u4f20\u7edf\u65b9\u6cd5\u7684\u4e0d\u53ef\u884c\u6027", "link": null, "type": "text"}], "type": "heading_1"}, {"items": [{"children": null, "listItems": [[{"annotations": " bold", "color": "default", "content": "a. ", "link": null, "type": "text"}, {"annotations": " bold code", "color": "default", "content": "autoplay", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": "\u5c5e\u6027", "link": null, "type": "text"}]], "type": "bulleted_list_item"}], "origin_type": "bulleted_list_item", "type": "bulleted_list_item_group"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "HTML 5\u7684 \u003caudio\u003e tag\u4e2d\u5b9e\u9645\u4e0a\u662f\u6709\u4e00\u4e2a\u53eb\u505a autoplay \u7684\u5c5e\u6027\u7684\uff0c\u4f46\u662f\u5728\u5927\u591a\u6570\u7684\u73b0\u4ee3\u6d4f\u89c8\u5668\u4e2d\u8fd9\u4e2a\u5c5e\u6027\u5f62\u540c\u865a\u8bbe\uff0c\u7531\u4e8e\u5b89\u5168\u6027\u7684\u539f\u56e0\u73b0\u4ee3\u6d4f\u89c8\u5668\u5e76\u4e0d\u5141\u8bb8\u97f3\u9891\u7684\u81ea\u52a8\u64ad\u653e\uff0c\u6bd5\u7adf\u5e7f\u544a\u7f51\u9875\u4e2d\u4f1a\u6ee5\u7528\u8fd9\u4e2a\u5c5e\u6027\u5bfc\u81f4\u4f53\u9a8c\u975e\u5e38\u4e0d\u597d\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"items": [{"children": null, "listItems": [[{"annotations": " bold", "color": "default", "content": "b. ", "link": null, "type": "text"}, {"annotations": " bold code", "color": "default", "content": ".play()", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": " \u65b9\u6cd5", "link": null, "type": "text"}]], "type": "bulleted_list_item"}], "origin_type": "bulleted_list_item", "type": "bulleted_list_item_group"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u540c\u6837\u7684\uff0c\u4f7f\u7528 ", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "\u003caudio\u003e", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": " tag\u7684", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": ".play()", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u65b9\u6cd5\u4e5f\u662f\u4e00\u6837\u65e0\u6548\uff0c\u539f\u56e0\u540c\u4e0a\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "id": "0ffe13ea-af8e-4409-af6e-3c5a34adcc04", "text": [{"annotations": " bold", "color": "default", "content": "2. \u65b9\u6cd5", "link": null, "type": "text"}], "type": "heading_1"}, {"children": null, "text": [{"annotations": " bold", "color": "default", "content": "\u5148", "link": null, "type": "text"}, {"annotations": " bold code", "color": "default", "content": "append", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": " \u4e00\u4e2a ", "link": null, "type": "text"}, {"annotations": " bold code", "color": "default", "content": "\u003caudio\u003e", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": " tag\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u5728document\u7684DOM\u7ed3\u6784\u52a0\u8f7d\u5b8c\u6210\u4e4b\u540e\uff08\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u7528jQ\u7684document.ready\uff09\uff0cappend\u4e00\u4e2a ", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "\u003caudio\u003e", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": " tag\u4e0a\u53bb\uff0c\u5e76\u6307\u5b9a\u6e90\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "//\u6211\u8fd9\u91cc\u7528\u7684\u662fDOMContentLoaded\u7684\u4e8b\u4ef6\uff0c\u6709\u6d4f\u89c8\u5668\u517c\u5bb9\u6027\u8981\u6c42\uff0c\u4f46\u662f\u6b64\u5904\u4e0d\u8003\u8651\n        document.addEventListener(\"DOMContentLoaded\", function(e){ \n//\u521b\u5efa\u4e00\u4e2a\u003caudio\u003e tag\uff0c\u5e76\u6307\u5b9a\u5c5e\u6027\n            var audioNode = document.createElement(\"audio\");\n            audioNode.setAttribute(\"src\",\"./auto.mp3\");\n            audioNode.setAttribute(\"id\",\"player\");\n            audioNode.controls = true;\n            audioNode.setAttribute(\"preload\",\"auto\");\n//append\u5230body\u4e0a\n            document.body.appendChild(audioNode);\n        })", "language": "language-javascript", "type": "code"}, {"children": null, "text": [{"annotations": " bold", "color": "default", "content": "\u518d\u5229\u7528\u5fae\u4fe1sdk\u89e6\u53d1\u64ad\u653e\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u5728\u5fae\u4fe1\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u7684\u7f51\u9875\u53ef\u4ee5\u52a0\u8f7d\u5fae\u4fe1\u7684js sdk\uff0c\u5c31\u662f\u4e00\u822c\u7528\u6765\u505a\u5fae\u4fe1\u767b\u9646\u3001\u5206\u4eab\u7b49\u7b49\u529f\u80fd\u7684\uff0c\u5728sdk ready\u65f6\u7684callback\u53ef\u4ee5\u7528\u6765\u89e6\u53d1", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "\u003caudio\u003e", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": " tag\u7684 ", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": ".play()", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u65b9\u6cd5\uff0c\u4ece\u800c\u81ea\u52a8\u64ad\u653e\u97f3\u4e50\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "//\u5148\u5f15\u7528\u4e0b\u5fae\u4fe1js sdk\n\u003cscript src=\"http://res.wx.qq.com/open/js/jweixin-1.0.0.js\"\u003e\u003c/script\u003e\n\u003cscript\u003e\nfunction autoPlayAudio() {\n    wx.config({\n// \u914d\u7f6e\u4fe1\u606f, \u5373\u4f7f\u4e0d\u6b63\u786e\u4e5f\u80fd\u4f7f\u7528 wx.ready\n        debug: false,\n        appId: \u0027\u0027,\n        timestamp: 1,\n        nonceStr: \u0027\u0027,\n        signature: \u0027\u0027,\n        jsApiList: []\n    });\n    wx.ready(function () {\n        var globalAudio = document.getElementById(\"player\");\n        globalAudio.play();\n    });\n};\n\u003c/script\u003e", "language": "language-javascript", "type": "code"}, {"children": null, "id": "efd96638-273b-4bc1-851a-e0077ea83efb", "text": [{"annotations": " bold", "color": "default", "content": "3. \u97f3\u4e50\u52a0\u8f7d\u72b6\u6001", "link": null, "type": "text"}], "type": "heading_1"}, {"children": null, "contents": "var globalAudio = document.getElementById(\"player\");\nvar statusP = document.getElementById(\"status\");\nglobalAudio.onloadstart = function(){\n    console.log(\"\u5f00\u59cb\u52a0\u8f7d\")\n    statusP.innerHTML = \"\u6b63\u5728\u52a0\u8f7d\";\n    globalAudio.oncanplay = function(){\n        statusP.innerHTML = \"\u52a0\u8f7d\u5b8c\u6210\";\n        autoPlayAudio();\n    }\n}", "language": "language-javascript", "type": "code"}, {"children": null, "text": [], "type": "paragraph"}, {"children": null, "text": [], "type": "paragraph"}], "cover": null, "create_date": "2020-01-26", "create_time": "", "ga": "UA-92314993-3", "page_title": "\u5fae\u4fe1\u6d4f\u89c8\u5668h5\u9875\u9762\u97f3\u4e50\u81ea\u52a8\u64ad\u653e\uff082020.02\u53ef\u7528\uff09", "site_name": "PRELUDE"}
        console.log(page_object)
    </script>
</head>
<body>


<!-- header area -->

    <div style="position: absolute; height: 400px;width: 100%;z-index: 0;display: flex; justify-content: center;">
  

        <div>
            
            <div class="header-article">
    <p><a href="../index.html">PRELUDE</a></p>
</div>
            
            <h1 class="page-title">微信浏览器h5页面音乐自动播放（2020.02可用）</h1>
            <i class="page-title">Create At: 2020-01-26 </i>
        </div>
    </div>


<!-- body area -->
    <div class="container" style="padding-top: 450px">
    <div>
        
        













<a href=#16899d30-8f2f-4880-9909-0458dd2f069b class=toc_level_1>1. 传统方法的不可行性</a>

<a href=#0ffe13ea-af8e-4409-af6e-3c5a34adcc04 class=toc_level_1>2. 方法</a>

<a href=#efd96638-273b-4bc1-851a-e0077ea83efb class=toc_level_1>3. 音乐加载状态</a>

    





<p>
        
        
            
<span class=" default">在做一些基于微信浏览器的h5页面的过程中，客户会希望进入即播放音乐，在搜集资料后找到了一种实际可用的方法。
需要看Demo的可以直接看最后一个标题。</span>

        
        
    </p>
    





<h2 id=16899d30-8f2f-4880-9909-0458dd2f069b>
        
            
<span class=" default">1</span>

        
            
<span class=" bold default">. 传统方法的不可行性</span>

        
    </h2>
    





<ul>
        
            <li>
        
            
                
<span class=" bold default">a. </span>

            
                
<span class=" bold code default">autoplay</span>

            
                
<span class=" bold default">属性</span>

            
        
    </li>
    
        
    </ul>
    


<div style="padding-left: 20px;">



</div>




<p>
        
        
            
<span class=" default">HTML 5的 &lt;audio&gt; tag中实际上是有一个叫做 autoplay 的属性的，但是在大多数的现代浏览器中这个属性形同虚设，由于安全性的原因现代浏览器并不允许音频的自动播放，毕竟广告网页中会滥用这个属性导致体验非常不好。</span>

        
        
    </p>
    





<ul>
        
            <li>
        
            
                
<span class=" bold default">b. </span>

            
                
<span class=" bold code default">.play()</span>

            
                
<span class=" bold default"> 方法</span>

            
        
    </li>
    
        
    </ul>
    


<div style="padding-left: 20px;">



</div>




<p>
        
        
            
<span class=" default">同样的，使用 </span>

        
        
        
            
<span class=" code default">&lt;audio&gt;</span>

        
        
        
            
<span class=" default"> tag的</span>

        
        
        
            
<span class=" code default">.play()</span>

        
        
        
            
<span class=" default">方法也是一样无效，原因同上。</span>

        
        
    </p>
    





<h2 id=0ffe13ea-af8e-4409-af6e-3c5a34adcc04>
        
            
<span class=" bold default">2. 方法</span>

        
    </h2>
    





<p>
        
        
            
<span class=" bold default">先</span>

        
        
        
            
<span class=" bold code default">append</span>

        
        
        
            
<span class=" bold default"> 一个 </span>

        
        
        
            
<span class=" bold code default">&lt;audio&gt;</span>

        
        
        
            
<span class=" bold default"> tag：</span>

        
        
    </p>
    





<p>
        
        
            
<span class=" default">在document的DOM结构加载完成之后（当然你也可以用jQ的document.ready），append一个 </span>

        
        
        
            
<span class=" code default">&lt;audio&gt;</span>

        
        
        
            
<span class=" default"> tag上去，并指定源：</span>

        
        
    </p>
    





<pre><code class=language-javascript>//我这里用的是DOMContentLoaded的事件，有浏览器兼容性要求，但是此处不考虑
        document.addEventListener(&#34;DOMContentLoaded&#34;, function(e){ 
//创建一个&lt;audio&gt; tag，并指定属性
            var audioNode = document.createElement(&#34;audio&#34;);
            audioNode.setAttribute(&#34;src&#34;,&#34;./auto.mp3&#34;);
            audioNode.setAttribute(&#34;id&#34;,&#34;player&#34;);
            audioNode.controls = true;
            audioNode.setAttribute(&#34;preload&#34;,&#34;auto&#34;);
//append到body上
            document.body.appendChild(audioNode);
        })</code></pre>
    





<p>
        
        
            
<span class=" bold default">再利用微信sdk触发播放：</span>

        
        
    </p>
    





<p>
        
        
            
<span class=" default">在微信浏览器中打开的网页可以加载微信的js sdk，就是一般用来做微信登陆、分享等等功能的，在sdk ready时的callback可以用来触发</span>

        
        
        
            
<span class=" code default">&lt;audio&gt;</span>

        
        
        
            
<span class=" default"> tag的 </span>

        
        
        
            
<span class=" code default">.play()</span>

        
        
        
            
<span class=" default">方法，从而自动播放音乐。</span>

        
        
    </p>
    





<pre><code class=language-javascript>//先引用下微信js sdk
&lt;script src=&#34;http://res.wx.qq.com/open/js/jweixin-1.0.0.js&#34;&gt;&lt;/script&gt;
&lt;script&gt;
function autoPlayAudio() {
    wx.config({
// 配置信息, 即使不正确也能使用 wx.ready
        debug: false,
        appId: &#39;&#39;,
        timestamp: 1,
        nonceStr: &#39;&#39;,
        signature: &#39;&#39;,
        jsApiList: []
    });
    wx.ready(function () {
        var globalAudio = document.getElementById(&#34;player&#34;);
        globalAudio.play();
    });
};
&lt;/script&gt;</code></pre>
    





<h2 id=efd96638-273b-4bc1-851a-e0077ea83efb>
        
            
<span class=" bold default">3. 音乐加载状态</span>

        
    </h2>
    





<pre><code class=language-javascript>var globalAudio = document.getElementById(&#34;player&#34;);
var statusP = document.getElementById(&#34;status&#34;);
globalAudio.onloadstart = function(){
    console.log(&#34;开始加载&#34;)
    statusP.innerHTML = &#34;正在加载&#34;;
    globalAudio.oncanplay = function(){
        statusP.innerHTML = &#34;加载完成&#34;;
        autoPlayAudio();
    }
}</code></pre>
    





<p>
        
    </p>
    





<p>
        
    </p>
    





    </div>
    <div class="footer">
    <p>Created by <a href="https://github.com/imyangmo/notionpaper">NotionPaper</a>, a tool that helps you use Notion like a CMS. </p>
    <p>This site uses <a href="https://simplecss.org/">Simple.css</a></p>
</div>

</div>
</body>
</html>