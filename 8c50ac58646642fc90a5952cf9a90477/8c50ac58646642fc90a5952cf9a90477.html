<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>新vps的一般初始化步骤 - PRELUDE</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='../style/basic_styles.css'>
    <link rel="stylesheet" href="https://unpkg.com/simpledotcss/simple.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src=https://www.googletagmanager.com/gtag/js?id=UA-92314993-3></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-92314993-3');
    </script>
    <script>
        const page_object = {"contents": [{"children": null, "contents": [{"id": "877d0a2a-6e4f-42e1-b282-58fadd579918", "level": 1, "text": "\u4e00\u3001\u66f4\u6539ssh\u7aef\u53e3"}, {"id": "9a2ec58a-8d82-43ff-bcd8-0a7e7a5254ab", "level": 1, "text": "\u4e8c\u3001\u66f4\u6539\u5bc6\u7801"}, {"id": "70bb939b-8628-49c4-aa95-ae0f314b7dd6", "level": 1, "text": "\u4e09\u3001\u5173\u6389firewalld"}, {"id": "d3cdc91d-6ad2-431d-a354-c75de6ed85e4", "level": 1, "text": "\u56db\u3001\u5347\u7ea7\u5185\u6838"}, {"id": "56b01591-754f-46bd-9de4-7c9101b0ae4b", "level": 1, "text": "\u4e94\u3001\u5f00\u542fbbr"}, {"id": "7264e11e-348f-4bcf-a116-a2a4bbe6c56e", "level": 1, "text": "\u516d\u3001\u6e05\u7a7aiptables\u89c4\u5219"}], "type": "table_of_contents"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u4ee5\u4e0b\u6240\u6709\u64cd\u4f5c\u5747\u662f\u5728root\u8d26\u6237\u4e0b\u64cd\u4f5c\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "id": "877d0a2a-6e4f-42e1-b282-58fadd579918", "text": [{"annotations": "", "color": "default", "content": "\u4e00\u3001", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": "\u66f4\u6539ssh\u7aef\u53e3", "link": null, "type": "text"}], "type": "heading_1"}, {"children": null, "contents": "vi /etc/ssh/sshd_config", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u628aport\u8fd9\u4e00\u884c\u6ce8\u91ca\u53bb\u6389\uff0c22\u6539\u6210\u4f60\u8981\u7684\u7aef\u53e3\u53f7\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "service sshd status", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u770b\u4e00\u4e0b\u662f\u4e0d\u662f\u5728\u76d1\u542c\u6307\u5b9a\u7aef\u53e3\u53f7\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "id": "9a2ec58a-8d82-43ff-bcd8-0a7e7a5254ab", "text": [{"annotations": "", "color": "default", "content": "\u4e8c\u3001", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": "\u66f4\u6539\u5bc6\u7801", "link": null, "type": "text"}], "type": "heading_1"}, {"children": null, "text": [{"annotations": " code", "color": "default", "content": "passwd", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u547d\u4ee4\u6572\u8fdb\u53bb\uff0c\u6362\u5bc6\u7801\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "id": "70bb939b-8628-49c4-aa95-ae0f314b7dd6", "text": [{"annotations": "", "color": "default", "content": "\u4e09\u3001", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": "\u5173\u6389firewalld", "link": null, "type": "text"}], "type": "heading_1"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "centos 7\u81ea\u5e26\u4e00\u4e2afirewalld\u9632\u706b\u5899\uff0c\u7528iptables\u5c31\u884c\u4e86\uff0cfirewalld\u7528\u5904\u4e0d\u662f\u5f88\u5927\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u5148\u770b\u4e00\u4e0bfirewalld\u662f\u4e0d\u662f\u5f00\u7740\u7684\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "firewall-cmd --state", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u5982\u679c\u662f", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "running", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u90a3\u5c31\u8981\u5148\u628a\u670d\u52a1\u5173\u4e86\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "systemctl stop firewalld", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u518ddisable\u6389\u4e0d\u8981\u5f00\u673a\u542f\u52a8\u4e86\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "systemctl disable firewalld\nsystemctl mask firewalld", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u6210\u4e86\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "id": "d3cdc91d-6ad2-431d-a354-c75de6ed85e4", "text": [{"annotations": "", "color": "default", "content": "\u56db\u3001", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": "\u5347\u7ea7\u5185\u6838", "link": null, "type": "text"}], "type": "heading_1"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u5148", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "yum update", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u4e00\u6ce2\uff0c\u518d\u5bfc\u5165ELRepo\u516c\u94a5", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u518d\u5b89\u88c5ELRepo(\u6ce8\uff1a\u6211\u7684\u662fcentos 7\uff0c\u5176\u4ed6\u7248\u672c", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u53c2\u8003", "link": "http://elrepo.org/tiki/tiki-index.php", "type": "text"}, {"annotations": "", "color": "default", "content": ")", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "yum install https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u7136\u540e\u76f4\u63a5\u5b89\u88c5\u6700\u65b0\u4e3b\u7ebf\u5185\u6838", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "yum --enablerepo=elrepo-kernel install kernel-ml", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u5b8c\u6210\u4e4b\u540e\u770b\u4e00\u4e0b\u65b0\u5185\u6838\u662f\u4e0d\u662f\u88c5\u4e0a\u53bb\u4e86", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "sudo awk -F\\\\\u0027 \u0027$1==\"menuentry \" {print i++ \" : \" $2}\u0027 /etc/grub2.cfg", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u6211\u7684\u663e\u793a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "[root@test2 ~]# awk -F\\\\\u0027 \u0027$1==\"menuentry \" {print i++ \" : \" $2}\u0027 /etc/grub2.cfg\n0 : CentOS Linux (5.1.3-1.el7.elrepo.x86_64) 7 (Core)\n1 : CentOS Linux (3.10.0-957.12.2.el7.x86_64) 7 (Core)\n2 : CentOS Linux (3.10.0-957.10.1.el7.x86_64) 7 (Core)\n3 : CentOS Linux (3.10.0-693.el7.x86_64) 7 (Core)\n4 : CentOS Linux (0-rescue-8508293106977c25a934808909d9e8a1) 7 (Core)", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "0\u5c31\u662f\u65b0\u5185\u6838\u3002\u4fdd\u9669\u8d77\u89c1\u518d\u8bbe\u7f6e\u4e00\u4e0b0\u4e3a\u9ed8\u8ba4\u542f\u52a8\u5185\u6838\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "grub2-set-default 0", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u6700\u540e\u751f\u6210grub2\u914d\u7f6e", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "grub2-mkconfig -o /boot/grub2/grub.cfg", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u54e6\u4e86\uff0c", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "reboot", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u5373\u53ef\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u91cd\u542f\u5b8c\u770b\u4e00\u4e0b", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "uname -r", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u662f\u4e0d\u662f\u7528\u65b0\u5185\u6838\u4e86\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "[root@test2 ~]# uname -r\n5.1.3-1.el7.elrepo.x86_64", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u6210\u4e86\u3002", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u53c2\u8003", "link": "https://www.howtoforge.com/tutorial/how-to-upgrade-kernel-in-centos-7-server/", "type": "text"}], "type": "paragraph"}, {"children": null, "id": "56b01591-754f-46bd-9de4-7c9101b0ae4b", "text": [{"annotations": "", "color": "default", "content": "\u4e94\u3001", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": "\u5f00\u542fbbr", "link": null, "type": "text"}], "type": "heading_1"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u5148", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "lsmod | grep bbr", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u770b\u4e00\u4e0b\u6709\u6ca1\u6709\u8fd4\u56de\u7ed3\u679c\uff0c\u6709\u5c31\u662f\u5f00\u8d77\u6765\u4e86\u3002\u6211\u662f\u6ca1\u5f00\u8d77\u6765\uff0c\u6240\u4ee5\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "modprobe tcp_bbr\necho \"tcp_bbr\" | sudo tee --append /etc/modules-load.d/modules.conf", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u7136\u540e\u6539\u4e00\u4e0b\u914d\u7f6e\u6587\u4ef6\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "echo \"net.core.default_qdisc=fq\" | sudo tee --append /etc/sysctl.conf\necho \"net.ipv4.tcp_congestion_control=bbr\" | sudo tee --append /etc/sysctl.conf", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u4fdd\u5b58\u4e00\u4e0b\u914d\u7f6e", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "sysctl -p", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u518d", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "lsmod | grep bbr", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u770b\u4e00\u4e0b\uff0c\u6210\u4e86\u3002", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u53c2\u8003", "link": "https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AF-TCP-BBR-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95", "type": "text"}], "type": "paragraph"}, {"children": null, "id": "7264e11e-348f-4bcf-a116-a2a4bbe6c56e", "text": [{"annotations": "", "color": "default", "content": "\u516d\u3001", "link": null, "type": "text"}, {"annotations": " bold", "color": "default", "content": "\u6e05\u7a7aiptables\u89c4\u5219", "link": null, "type": "text"}], "type": "heading_1"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u4e2a\u4eba\u4e60\u60ef\u628aiptables\u6e05\u9664\u4e00\u904d\uff0c\u518d\u505a\u914d\u7f6e\u3002", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "iptables -t nat -F  \niptables -t nat -X  \niptables -t nat -P PREROUTING ACCEPT  \niptables -t nat -P POSTROUTING ACCEPT  \niptables -t nat -P OUTPUT ACCEPT  \niptables -t mangle -F  \niptables -t mangle -X  \niptables -t mangle -P PREROUTING ACCEPT  \niptables -t mangle -P INPUT ACCEPT  \niptables -t mangle -P FORWARD ACCEPT  \niptables -t mangle -P OUTPUT ACCEPT  \niptables -t mangle -P POSTROUTING ACCEPT  \niptables -F  \niptables -X  \niptables -P FORWARD ACCEPT  \niptables -P INPUT ACCEPT  \niptables -P OUTPUT ACCEPT  \niptables -t raw -F  \niptables -t raw -X  \niptables -t raw -P PREROUTING ACCEPT  \niptables -t raw -P OUTPUT ACCEPT", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u518d", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "iptables-save", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u770b\u4e00\u4e0b\u914d\u7f6e\u662f\u4e0d\u662f\u6e05\u9664\u5e72\u51c0\u4e86\u3002", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u53c2\u8003", "link": "http://os.51cto.com/art/201103/249518.htm", "type": "text"}], "type": "paragraph"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u4e4b\u540e\u518d", "link": null, "type": "text"}, {"annotations": " code", "color": "default", "content": "service iptables save", "link": null, "type": "text"}, {"annotations": "", "color": "default", "content": "\u4fdd\u5b58\u4e00\u4e0b\u3002\u5982\u679c\u51fa\u73b0\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "[root@test2 ~]# service iptables save\nThe service command supports only basic LSB actions (start, stop, restart, try-restart, reload, force-reload, status). For other actions, please try to use systemctl.", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u90a3\u5c31\u662f\u7cfb\u7edf\u7684iptables\u6ca1\u88c5\u597d\uff0c\u518d\u88c5\u4e00\u4e0b\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "yum install iptables-services", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u518d\u786e\u4fdd\u4e00\u4e0b\u81ea\u542f\uff1a", "link": null, "type": "text"}], "type": "paragraph"}, {"children": null, "contents": "systemctl enable iptables\nsystemctl start iptables", "language": "language-bash", "type": "code"}, {"children": null, "text": [{"annotations": "", "color": "default", "content": "\u53c2\u8003", "link": "https://stackoverflow.com/questions/24756240/how-can-i-use-iptables-on-centos-7", "type": "text"}], "type": "paragraph"}, {"children": null, "text": [], "type": "paragraph"}], "cover": null, "create_date": "2019-05-19", "create_time": "00:00:00", "ga": "UA-92314993-3", "page_title": "\u65b0vps\u7684\u4e00\u822c\u521d\u59cb\u5316\u6b65\u9aa4", "site_name": "PRELUDE"}
        console.log(page_object)
    </script>
</head>
<body>


<!-- header area -->

    <div style="position: absolute; height: 400px;width: 100%;z-index: 0;display: flex; justify-content: center;">
  

        <div>
            
            <div class="header-article">
    <p><a href="../index.html">PRELUDE</a></p>
</div>
            
            <h1 class="page-title">新vps的一般初始化步骤</h1>
            <i class="page-title">Create At: 2019-05-19 00:00:00</i>
        </div>
    </div>


<!-- body area -->
    <div class="container" style="padding-top: 450px">
    <div>
        
        













<a href=#877d0a2a-6e4f-42e1-b282-58fadd579918 class=toc_level_1>一、更改ssh端口</a>

<a href=#9a2ec58a-8d82-43ff-bcd8-0a7e7a5254ab class=toc_level_1>二、更改密码</a>

<a href=#70bb939b-8628-49c4-aa95-ae0f314b7dd6 class=toc_level_1>三、关掉firewalld</a>

<a href=#d3cdc91d-6ad2-431d-a354-c75de6ed85e4 class=toc_level_1>四、升级内核</a>

<a href=#56b01591-754f-46bd-9de4-7c9101b0ae4b class=toc_level_1>五、开启bbr</a>

<a href=#7264e11e-348f-4bcf-a116-a2a4bbe6c56e class=toc_level_1>六、清空iptables规则</a>

    





<p>
        
        
            
<span class=" default">以下所有操作均是在root账户下操作。</span>

        
        
    </p>
    





<h2 id=877d0a2a-6e4f-42e1-b282-58fadd579918>
        
            
<span class=" default">一、</span>

        
            
<span class=" bold default">更改ssh端口</span>

        
    </h2>
    





<pre><code class=language-bash>vi /etc/ssh/sshd_config</code></pre>
    





<p>
        
        
            
<span class=" default">把port这一行注释去掉，22改成你要的端口号。</span>

        
        
    </p>
    





<pre><code class=language-bash>service sshd status</code></pre>
    





<p>
        
        
            
<span class=" default">看一下是不是在监听指定端口号。</span>

        
        
    </p>
    





<h2 id=9a2ec58a-8d82-43ff-bcd8-0a7e7a5254ab>
        
            
<span class=" default">二、</span>

        
            
<span class=" bold default">更改密码</span>

        
    </h2>
    





<p>
        
        
            
<span class=" code default">passwd</span>

        
        
        
            
<span class=" default">命令敲进去，换密码。</span>

        
        
    </p>
    





<h2 id=70bb939b-8628-49c4-aa95-ae0f314b7dd6>
        
            
<span class=" default">三、</span>

        
            
<span class=" bold default">关掉firewalld</span>

        
    </h2>
    





<p>
        
        
            
<span class=" default">centos 7自带一个firewalld防火墙，用iptables就行了，firewalld用处不是很大。</span>

        
        
    </p>
    





<p>
        
        
            
<span class=" default">先看一下firewalld是不是开着的：</span>

        
        
    </p>
    





<pre><code class=language-bash>firewall-cmd --state</code></pre>
    





<p>
        
        
            
<span class=" default">如果是</span>

        
        
        
            
<span class=" code default">running</span>

        
        
        
            
<span class=" default">那就要先把服务关了：</span>

        
        
    </p>
    





<pre><code class=language-bash>systemctl stop firewalld</code></pre>
    





<p>
        
        
            
<span class=" default">再disable掉不要开机启动了：</span>

        
        
    </p>
    





<pre><code class=language-bash>systemctl disable firewalld
systemctl mask firewalld</code></pre>
    





<p>
        
        
            
<span class=" default">成了。</span>

        
        
    </p>
    





<h2 id=d3cdc91d-6ad2-431d-a354-c75de6ed85e4>
        
            
<span class=" default">四、</span>

        
            
<span class=" bold default">升级内核</span>

        
    </h2>
    





<p>
        
        
            
<span class=" default">先</span>

        
        
        
            
<span class=" code default">yum update</span>

        
        
        
            
<span class=" default">一波，再导入ELRepo公钥</span>

        
        
    </p>
    





<pre><code class=language-bash>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</code></pre>
    





<p>
        
        
            
<span class=" default">再安装ELRepo(注：我的是centos 7，其他版本</span>

        
        
        
            
<a href=http://elrepo.org/tiki/tiki-index.php class=" default">参考</a>

        
        
        
            
<span class=" default">)</span>

        
        
    </p>
    





<pre><code class=language-bash>yum install https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</code></pre>
    





<p>
        
        
            
<span class=" default">然后直接安装最新主线内核</span>

        
        
    </p>
    





<pre><code class=language-bash>yum --enablerepo=elrepo-kernel install kernel-ml</code></pre>
    





<p>
        
        
            
<span class=" default">完成之后看一下新内核是不是装上去了</span>

        
        
    </p>
    





<pre><code class=language-bash>sudo awk -F\\&#39; &#39;$1==&#34;menuentry &#34; {print i++ &#34; : &#34; $2}&#39; /etc/grub2.cfg</code></pre>
    





<p>
        
        
            
<span class=" default">我的显示</span>

        
        
    </p>
    





<pre><code class=language-bash>[root@test2 ~]# awk -F\\&#39; &#39;$1==&#34;menuentry &#34; {print i++ &#34; : &#34; $2}&#39; /etc/grub2.cfg
0 : CentOS Linux (5.1.3-1.el7.elrepo.x86_64) 7 (Core)
1 : CentOS Linux (3.10.0-957.12.2.el7.x86_64) 7 (Core)
2 : CentOS Linux (3.10.0-957.10.1.el7.x86_64) 7 (Core)
3 : CentOS Linux (3.10.0-693.el7.x86_64) 7 (Core)
4 : CentOS Linux (0-rescue-8508293106977c25a934808909d9e8a1) 7 (Core)</code></pre>
    





<p>
        
        
            
<span class=" default">0就是新内核。保险起见再设置一下0为默认启动内核：</span>

        
        
    </p>
    





<pre><code class=language-bash>grub2-set-default 0</code></pre>
    





<p>
        
        
            
<span class=" default">最后生成grub2配置</span>

        
        
    </p>
    





<pre><code class=language-bash>grub2-mkconfig -o /boot/grub2/grub.cfg</code></pre>
    





<p>
        
        
            
<span class=" default">哦了，</span>

        
        
        
            
<span class=" code default">reboot</span>

        
        
        
            
<span class=" default">即可。</span>

        
        
    </p>
    





<p>
        
        
            
<span class=" default">重启完看一下</span>

        
        
        
            
<span class=" code default">uname -r</span>

        
        
        
            
<span class=" default">是不是用新内核了：</span>

        
        
    </p>
    





<pre><code class=language-bash>[root@test2 ~]# uname -r
5.1.3-1.el7.elrepo.x86_64</code></pre>
    





<p>
        
        
            
<span class=" default">成了。</span>

        
        
        
            
<a href=https://www.howtoforge.com/tutorial/how-to-upgrade-kernel-in-centos-7-server/ class=" default">参考</a>

        
        
    </p>
    





<h2 id=56b01591-754f-46bd-9de4-7c9101b0ae4b>
        
            
<span class=" default">五、</span>

        
            
<span class=" bold default">开启bbr</span>

        
    </h2>
    





<p>
        
        
            
<span class=" default">先</span>

        
        
        
            
<span class=" code default">lsmod | grep bbr</span>

        
        
        
            
<span class=" default">看一下有没有返回结果，有就是开起来了。我是没开起来，所以：</span>

        
        
    </p>
    





<pre><code class=language-bash>modprobe tcp_bbr
echo &#34;tcp_bbr&#34; | sudo tee --append /etc/modules-load.d/modules.conf</code></pre>
    





<p>
        
        
            
<span class=" default">然后改一下配置文件：</span>

        
        
    </p>
    





<pre><code class=language-bash>echo &#34;net.core.default_qdisc=fq&#34; | sudo tee --append /etc/sysctl.conf
echo &#34;net.ipv4.tcp_congestion_control=bbr&#34; | sudo tee --append /etc/sysctl.conf</code></pre>
    





<p>
        
        
            
<span class=" default">保存一下配置</span>

        
        
    </p>
    





<pre><code class=language-bash>sysctl -p</code></pre>
    





<p>
        
        
            
<span class=" default">再</span>

        
        
        
            
<span class=" code default">lsmod | grep bbr</span>

        
        
        
            
<span class=" default">看一下，成了。</span>

        
        
        
            
<a href=https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AF-TCP-BBR-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95 class=" default">参考</a>

        
        
    </p>
    





<h2 id=7264e11e-348f-4bcf-a116-a2a4bbe6c56e>
        
            
<span class=" default">六、</span>

        
            
<span class=" bold default">清空iptables规则</span>

        
    </h2>
    





<p>
        
        
            
<span class=" default">个人习惯把iptables清除一遍，再做配置。</span>

        
        
    </p>
    





<pre><code class=language-bash>iptables -t nat -F  
iptables -t nat -X  
iptables -t nat -P PREROUTING ACCEPT  
iptables -t nat -P POSTROUTING ACCEPT  
iptables -t nat -P OUTPUT ACCEPT  
iptables -t mangle -F  
iptables -t mangle -X  
iptables -t mangle -P PREROUTING ACCEPT  
iptables -t mangle -P INPUT ACCEPT  
iptables -t mangle -P FORWARD ACCEPT  
iptables -t mangle -P OUTPUT ACCEPT  
iptables -t mangle -P POSTROUTING ACCEPT  
iptables -F  
iptables -X  
iptables -P FORWARD ACCEPT  
iptables -P INPUT ACCEPT  
iptables -P OUTPUT ACCEPT  
iptables -t raw -F  
iptables -t raw -X  
iptables -t raw -P PREROUTING ACCEPT  
iptables -t raw -P OUTPUT ACCEPT</code></pre>
    





<p>
        
        
            
<span class=" default">再</span>

        
        
        
            
<span class=" code default">iptables-save</span>

        
        
        
            
<span class=" default">看一下配置是不是清除干净了。</span>

        
        
        
            
<a href=http://os.51cto.com/art/201103/249518.htm class=" default">参考</a>

        
        
    </p>
    





<p>
        
        
            
<span class=" default">之后再</span>

        
        
        
            
<span class=" code default">service iptables save</span>

        
        
        
            
<span class=" default">保存一下。如果出现：</span>

        
        
    </p>
    





<pre><code class=language-bash>[root@test2 ~]# service iptables save
The service command supports only basic LSB actions (start, stop, restart, try-restart, reload, force-reload, status). For other actions, please try to use systemctl.</code></pre>
    





<p>
        
        
            
<span class=" default">那就是系统的iptables没装好，再装一下：</span>

        
        
    </p>
    





<pre><code class=language-bash>yum install iptables-services</code></pre>
    





<p>
        
        
            
<span class=" default">再确保一下自启：</span>

        
        
    </p>
    





<pre><code class=language-bash>systemctl enable iptables
systemctl start iptables</code></pre>
    





<p>
        
        
            
<a href=https://stackoverflow.com/questions/24756240/how-can-i-use-iptables-on-centos-7 class=" default">参考</a>

        
        
    </p>
    





<p>
        
    </p>
    





    </div>
    <div class="footer">
    <p>Created by <a href="https://github.com/imyangmo/notionpaper">NotionPaper</a>, a tool that helps you use Notion like a CMS. </p>
    <p>This site uses <a href="https://simplecss.org/">Simple.css</a></p>
</div>

</div>
</body>
</html>